<html>
<head>
    <title>Javascript client demo</title>
    <script src="js/sjcl.js"></script>
    <script src="js/nacl.min.js"></script>
    <script src="js/nacl-util.min.js"></script>
    <script src="js/lighttor.js"></script>
    <meta charset="UTF-8"> 
</head>
<body>
    <pre id='loaded'>Nothing to see here! </pre>
    <pre id='consensus'>Number of routers: </pre>
    <pre id='guard'>Guard identity is: </pre>
    <pre id='id'>Channel create id: </pre>
    <pre id='shared'>Circ. shared keys: </pre>

    <script>
        document.getElementById('loaded').innerHTML += 'Loaded!';

        endpoint = lighttor.endpoint('localhost')
        lighttor.get.consensus(endpoint,
            function(endpoint)
            {
                nb = endpoint.consensus.routers.length
                document.getElementById('consensus').innerHTML += nb.toString()
            })

        lighttor.get.guard(endpoint,
            function(endpoint)
            {
                identity = endpoint.guard.router.identity
                document.getElementById('guard').innerHTML += identity

                lighttor.post.create(endpoint,
                    function(endpoint)
                    {
                        document.getElementById('id').innerHTML += endpoint.id

                        shared = endpoint.material
                        shared = nacl.util.encodeBase64(shared)
                        document.getElementById('shared').innerHTML += shared
                    })
            })
    </script>
</body>
</html>
